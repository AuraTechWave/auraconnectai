<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Comprehensive restaurant management platform documentation"><meta name=author content=AuraTechWave><link href=https://docs.auraconnect.com/dev/architecture/rbac_system_architecture/ rel=canonical><link href=../pos_integration_architecture/ rel=prev><link href=../../../api/ rel=next><link rel=icon href=../../../assets/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.21"><title>RBAC System - AuraConnect Documentation</title><link rel=stylesheet href=../../../assets/stylesheets/main.2a3383ac.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-XXXXXXXXXX"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-XXXXXXXXXX",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#role-based-access-control-rbac-system-architecture class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="AuraConnect Documentation" class="md-header__button md-logo" aria-label="AuraConnect Documentation" data-md-component=logo> <img src=../../../assets/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AuraConnect Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> RBAC System </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/AuraTechWave/auraconnectai title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> auraconnectai </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../guides/getting-started/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../../modules/ class=md-tabs__link> Core Modules </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../../architecture/ class=md-tabs__link> Architecture </a> </li> <li class=md-tabs__item> <a href=../../../api/ class=md-tabs__link> API Reference </a> </li> <li class=md-tabs__item> <a href=../../../feature_docs/ class=md-tabs__link> Feature Documentation </a> </li> <li class=md-tabs__item> <a href=../../../deployment/ class=md-tabs__link> Deployment </a> </li> <li class=md-tabs__item> <a href=../../ class=md-tabs__link> Developer Guide </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="AuraConnect Documentation" class="md-nav__button md-logo" aria-label="AuraConnect Documentation" data-md-component=logo> <img src=../../../assets/logo.png alt=logo> </a> AuraConnect Documentation </label> <div class=md-nav__source> <a href=https://github.com/AuraTechWave/auraconnectai title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> auraconnectai </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../guides/getting-started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../modules/ class=md-nav__link> <span class=md-ellipsis> Core Modules </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <div class="md-nav__link md-nav__container"> <a href=../../../architecture/ class="md-nav__link "> <span class=md-ellipsis> Architecture </span> </a> <label class="md-nav__link " for=__nav_4 id=__nav_4_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2 checked> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex> <span class=md-ellipsis> Dev Architecture </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=true> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Dev Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../order_management_architecture/ class=md-nav__link> <span class=md-ellipsis> Order Management </span> </a> </li> <li class=md-nav__item> <a href=../menu_inventory_architecture/ class=md-nav__link> <span class=md-ellipsis> Menu & Inventory </span> </a> </li> <li class=md-nav__item> <a href=../staff_management_architecture/ class=md-nav__link> <span class=md-ellipsis> Staff Management </span> </a> </li> <li class=md-nav__item> <a href=../payroll_integration/ class=md-nav__link> <span class=md-ellipsis> Payroll Integration </span> </a> </li> <li class=md-nav__item> <a href=../taxing_payroll_architecture/ class=md-nav__link> <span class=md-ellipsis> Tax & Payroll </span> </a> </li> <li class=md-nav__item> <a href=../pos_integration_architecture/ class=md-nav__link> <span class=md-ellipsis> POS Integration </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> RBAC System </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> RBAC System </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#system-design class=md-nav__link> <span class=md-ellipsis> System Design </span> </a> <nav class=md-nav aria-label="System Design"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#core-components class=md-nav__link> <span class=md-ellipsis> Core Components </span> </a> </li> <li class=md-nav__item> <a href=#permission-model class=md-nav__link> <span class=md-ellipsis> Permission Model </span> </a> </li> <li class=md-nav__item> <a href=#role-hierarchy class=md-nav__link> <span class=md-ellipsis> Role Hierarchy </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#database-schema class=md-nav__link> <span class=md-ellipsis> Database Schema </span> </a> <nav class=md-nav aria-label="Database Schema"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#core-tables class=md-nav__link> <span class=md-ellipsis> Core Tables </span> </a> </li> <li class=md-nav__item> <a href=#association-tables class=md-nav__link> <span class=md-ellipsis> Association Tables </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#api-endpoints class=md-nav__link> <span class=md-ellipsis> API Endpoints </span> </a> <nav class=md-nav aria-label="API Endpoints"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#authentication-endpoints class=md-nav__link> <span class=md-ellipsis> Authentication Endpoints </span> </a> </li> <li class=md-nav__item> <a href=#rbac-management-endpoints class=md-nav__link> <span class=md-ellipsis> RBAC Management Endpoints </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#backend-implementation class=md-nav__link> <span class=md-ellipsis> Backend Implementation </span> </a> <nav class=md-nav aria-label="Backend Implementation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#service-layer class=md-nav__link> <span class=md-ellipsis> Service Layer </span> </a> </li> <li class=md-nav__item> <a href=#fastapi-dependencies class=md-nav__link> <span class=md-ellipsis> FastAPI Dependencies </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#frontend-implementation class=md-nav__link> <span class=md-ellipsis> Frontend Implementation </span> </a> <nav class=md-nav aria-label="Frontend Implementation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#react-context-and-hooks class=md-nav__link> <span class=md-ellipsis> React Context and Hooks </span> </a> </li> <li class=md-nav__item> <a href=#guard-components class=md-nav__link> <span class=md-ellipsis> Guard Components </span> </a> </li> <li class=md-nav__item> <a href=#convenience-hooks class=md-nav__link> <span class=md-ellipsis> Convenience Hooks </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#multi-tenancy-support class=md-nav__link> <span class=md-ellipsis> Multi-Tenancy Support </span> </a> <nav class=md-nav aria-label="Multi-Tenancy Support"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tenant-scoped-permissions class=md-nav__link> <span class=md-ellipsis> Tenant-Scoped Permissions </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security-features class=md-nav__link> <span class=md-ellipsis> Security Features </span> </a> <nav class=md-nav aria-label="Security Features"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#account-lockout class=md-nav__link> <span class=md-ellipsis> Account Lockout </span> </a> </li> <li class=md-nav__item> <a href=#session-management class=md-nav__link> <span class=md-ellipsis> Session Management </span> </a> </li> <li class=md-nav__item> <a href=#token-security class=md-nav__link> <span class=md-ellipsis> Token Security </span> </a> </li> <li class=md-nav__item> <a href=#audit-trail class=md-nav__link> <span class=md-ellipsis> Audit Trail </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#performance-considerations class=md-nav__link> <span class=md-ellipsis> Performance Considerations </span> </a> <nav class=md-nav aria-label="Performance Considerations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#permission-caching class=md-nav__link> <span class=md-ellipsis> Permission Caching </span> </a> </li> <li class=md-nav__item> <a href=#database-optimizations class=md-nav__link> <span class=md-ellipsis> Database Optimizations </span> </a> </li> <li class=md-nav__item> <a href=#frontend-optimizations class=md-nav__link> <span class=md-ellipsis> Frontend Optimizations </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#migration-and-setup class=md-nav__link> <span class=md-ellipsis> Migration and Setup </span> </a> <nav class=md-nav aria-label="Migration and Setup"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#database-migration class=md-nav__link> <span class=md-ellipsis> Database Migration </span> </a> </li> <li class=md-nav__item> <a href=#environment-configuration class=md-nav__link> <span class=md-ellipsis> Environment Configuration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#best-practices class=md-nav__link> <span class=md-ellipsis> Best Practices </span> </a> <nav class=md-nav aria-label="Best Practices"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#permission-design class=md-nav__link> <span class=md-ellipsis> Permission Design </span> </a> </li> <li class=md-nav__item> <a href=#role-design class=md-nav__link> <span class=md-ellipsis> Role Design </span> </a> </li> <li class=md-nav__item> <a href=#security class=md-nav__link> <span class=md-ellipsis> Security </span> </a> </li> <li class=md-nav__item> <a href=#performance class=md-nav__link> <span class=md-ellipsis> Performance </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#testing class=md-nav__link> <span class=md-ellipsis> Testing </span> </a> <nav class=md-nav aria-label=Testing> <ul class=md-nav__list> <li class=md-nav__item> <a href=#backend-tests class=md-nav__link> <span class=md-ellipsis> Backend Tests </span> </a> </li> <li class=md-nav__item> <a href=#frontend-tests class=md-nav__link> <span class=md-ellipsis> Frontend Tests </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> <nav class=md-nav aria-label=Troubleshooting> <ul class=md-nav__list> <li class=md-nav__item> <a href=#common-issues class=md-nav__link> <span class=md-ellipsis> Common Issues </span> </a> </li> <li class=md-nav__item> <a href=#debug-tools class=md-nav__link> <span class=md-ellipsis> Debug Tools </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#conclusion class=md-nav__link> <span class=md-ellipsis> Conclusion </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../api/ class=md-nav__link> <span class=md-ellipsis> API Reference </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../feature_docs/ class=md-nav__link> <span class=md-ellipsis> Feature Documentation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../deployment/ class=md-nav__link> <span class=md-ellipsis> Deployment </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../ class=md-nav__link> <span class=md-ellipsis> Developer Guide </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=role-based-access-control-rbac-system-architecture>Role-Based Access Control (RBAC) System Architecture<a class=headerlink href=#role-based-access-control-rbac-system-architecture title="Permanent link">&para;</a></h1> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p>The AuraConnect AI RBAC system provides comprehensive, fine-grained access control for all system operations. It implements a flexible role and permission-based security model that supports multi-tenancy, hierarchical roles, and session-based permission caching.</p> <h2 id=system-design>System Design<a class=headerlink href=#system-design title="Permanent link">&para;</a></h2> <h3 id=core-components>Core Components<a class=headerlink href=#core-components title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>┌─────────────────────────────────────────────────────────────┐
│                      RBAC System                           │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │    Users    │  │    Roles    │  │    Permissions      │  │
│  │             │  │             │  │                     │  │
│  │ - ID        │  │ - ID        │  │ - ID                │  │
│  │ - Username  │  │ - Name      │  │ - Key               │  │
│  │ - Email     │  │ - Display   │  │ - Resource:Action   │  │
│  │ - Tenants   │  │ - Parent    │  │ - Description       │  │
│  │ - Status    │  │ - Tenants   │  │ - Tenants           │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
│         │                │                      │           │
│         └────────────────┼──────────────────────┘           │
│                          │                                  │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │              Association Tables                         │  │
│  │  ┌─────────────────┐    ┌─────────────────────────────┐ │  │
│  │  │  User-Roles     │    │    Role-Permissions         │ │  │
│  │  │  - User ID      │    │    - Role ID                │ │  │
│  │  │  - Role ID      │    │    - Permission ID          │ │  │
│  │  │  - Tenant ID    │    │    - Granted At             │ │  │
│  │  │  - Expires At   │    │    - Granted By             │ │  │
│  │  │  - Granted By   │    └─────────────────────────────┘ │  │
│  │  └─────────────────┘                                    │  │
│  └─────────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐  │
│  │              Enhanced Features                          │  │
│  │  ┌─────────────────┐    ┌─────────────────────────────┐ │  │
│  │  │ Direct Perms    │    │    RBAC Sessions            │ │  │
│  │  │ - User ID       │    │    - Session ID             │ │  │
│  │  │ - Permission    │    │    - User ID                │ │  │
│  │  │ - Grant/Deny    │    │    - Active Tenant          │ │  │
│  │  │ - Tenant/Rsrc   │    │    - Cached Permissions     │ │  │
│  │  │ - Expires At    │    │    - Cache Expires          │ │  │
│  │  └─────────────────┘    └─────────────────────────────┘ │  │
│  └─────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
</code></pre></div> <h3 id=permission-model>Permission Model<a class=headerlink href=#permission-model title="Permanent link">&para;</a></h3> <p>The system uses a <strong>Resource:Action</strong> permission model:</p> <div class=highlight><pre><span></span><code>Permission Key: &lt;resource&gt;:&lt;action&gt;
Examples:
- staff:read         # View staff information
- staff:write        # Create/update staff records
- payroll:approve    # Approve payroll runs
- order:manage_kitchen # Kitchen operations access
- system:audit       # Access audit logs
</code></pre></div> <h3 id=role-hierarchy>Role Hierarchy<a class=headerlink href=#role-hierarchy title="Permanent link">&para;</a></h3> <p>Roles support hierarchical inheritance:</p> <div class=highlight><pre><span></span><code>super_admin
├── admin
│   ├── manager
│   │   ├── staff_manager
│   │   └── kitchen_manager
│   └── payroll_manager
│       └── payroll_clerk
└── viewer
    └── server
</code></pre></div> <h2 id=database-schema>Database Schema<a class=headerlink href=#database-schema title="Permanent link">&para;</a></h2> <h3 id=core-tables>Core Tables<a class=headerlink href=#core-tables title="Permanent link">&para;</a></h3> <h4 id=rbac_users>rbac_users<a class=headerlink href=#rbac_users title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>rbac_users</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>SERIAL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
<span class=w>    </span><span class=n>username</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=w> </span><span class=k>UNIQUE</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
<span class=w>    </span><span class=n>email</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w> </span><span class=k>UNIQUE</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
<span class=w>    </span><span class=n>hashed_password</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
<span class=w>    </span><span class=n>is_active</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>TRUE</span><span class=p>,</span>
<span class=w>    </span><span class=n>is_email_verified</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>FALSE</span><span class=p>,</span>
<span class=w>    </span><span class=n>created_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>NOW</span><span class=p>(),</span>
<span class=w>    </span><span class=n>updated_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>NOW</span><span class=p>(),</span>
<span class=w>    </span><span class=n>last_login</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=p>,</span>
<span class=w>    </span><span class=n>first_name</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>50</span><span class=p>),</span>
<span class=w>    </span><span class=n>last_name</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>50</span><span class=p>),</span>
<span class=w>    </span><span class=n>phone</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span>
<span class=w>    </span><span class=n>default_tenant_id</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
<span class=w>    </span><span class=n>accessible_tenant_ids</span><span class=w> </span><span class=n>JSONB</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=s1>&#39;[]&#39;</span><span class=p>,</span>
<span class=w>    </span><span class=n>failed_login_attempts</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
<span class=w>    </span><span class=n>locked_until</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=p>,</span>
<span class=w>    </span><span class=n>password_changed_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>NOW</span><span class=p>()</span>
<span class=p>);</span>
</code></pre></div> <h4 id=rbac_roles>rbac_roles<a class=headerlink href=#rbac_roles title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>rbac_roles</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>SERIAL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
<span class=w>    </span><span class=n>name</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=w> </span><span class=k>UNIQUE</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
<span class=w>    </span><span class=n>display_name</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
<span class=w>    </span><span class=n>description</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
<span class=w>    </span><span class=n>parent_role_id</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=n>rbac_roles</span><span class=p>(</span><span class=n>id</span><span class=p>),</span>
<span class=w>    </span><span class=n>is_active</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>TRUE</span><span class=p>,</span>
<span class=w>    </span><span class=n>is_system_role</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>FALSE</span><span class=p>,</span>
<span class=w>    </span><span class=n>created_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>NOW</span><span class=p>(),</span>
<span class=w>    </span><span class=n>updated_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>NOW</span><span class=p>(),</span>
<span class=w>    </span><span class=n>tenant_ids</span><span class=w> </span><span class=n>JSONB</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=s1>&#39;[]&#39;</span>
<span class=p>);</span>
</code></pre></div> <h4 id=rbac_permissions>rbac_permissions<a class=headerlink href=#rbac_permissions title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>rbac_permissions</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>SERIAL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
<span class=w>    </span><span class=k>key</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w> </span><span class=k>UNIQUE</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
<span class=w>    </span><span class=n>name</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
<span class=w>    </span><span class=n>description</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
<span class=w>    </span><span class=n>resource</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
<span class=w>    </span><span class=n>action</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
<span class=w>    </span><span class=n>is_active</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>TRUE</span><span class=p>,</span>
<span class=w>    </span><span class=n>is_system_permission</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>FALSE</span><span class=p>,</span>
<span class=w>    </span><span class=n>created_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>NOW</span><span class=p>(),</span>
<span class=w>    </span><span class=n>tenant_ids</span><span class=w> </span><span class=n>JSONB</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=s1>&#39;[]&#39;</span>
<span class=p>);</span>
</code></pre></div> <h3 id=association-tables>Association Tables<a class=headerlink href=#association-tables title="Permanent link">&para;</a></h3> <h4 id=user_roles>user_roles<a class=headerlink href=#user_roles title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>user_roles</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=n>user_id</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=n>rbac_users</span><span class=p>(</span><span class=n>id</span><span class=p>),</span>
<span class=w>    </span><span class=n>role_id</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=n>rbac_roles</span><span class=p>(</span><span class=n>id</span><span class=p>),</span>
<span class=w>    </span><span class=n>tenant_id</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
<span class=w>    </span><span class=n>granted_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>NOW</span><span class=p>(),</span>
<span class=w>    </span><span class=n>granted_by</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=n>rbac_users</span><span class=p>(</span><span class=n>id</span><span class=p>),</span>
<span class=w>    </span><span class=n>expires_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=p>,</span>
<span class=w>    </span><span class=n>is_active</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>TRUE</span><span class=p>,</span>
<span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span><span class=w> </span><span class=n>role_id</span><span class=p>)</span>
<span class=p>);</span>
</code></pre></div> <h4 id=role_permissions>role_permissions<a class=headerlink href=#role_permissions title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>role_permissions</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=n>role_id</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=n>rbac_roles</span><span class=p>(</span><span class=n>id</span><span class=p>),</span>
<span class=w>    </span><span class=n>permission_id</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=n>rbac_permissions</span><span class=p>(</span><span class=n>id</span><span class=p>),</span>
<span class=w>    </span><span class=n>granted_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>NOW</span><span class=p>(),</span>
<span class=w>    </span><span class=n>granted_by</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=n>rbac_users</span><span class=p>(</span><span class=n>id</span><span class=p>),</span>
<span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=n>role_id</span><span class=p>,</span><span class=w> </span><span class=n>permission_id</span><span class=p>)</span>
<span class=p>);</span>
</code></pre></div> <h2 id=api-endpoints>API Endpoints<a class=headerlink href=#api-endpoints title="Permanent link">&para;</a></h2> <h3 id=authentication-endpoints>Authentication Endpoints<a class=headerlink href=#authentication-endpoints title="Permanent link">&para;</a></h3> <h4 id=enhanced-login>Enhanced Login<a class=headerlink href=#enhanced-login title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class=err>POST /auth/login/rbac?tenant_id=1</span>
<span class=err>Content-Type: application/x-www-form-urlencoded</span>

<span class=err>username=admin&amp;password=secret</span>
</code></pre></div> <p>Response: <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=nt>&quot;access_token&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;eyJ...&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;refresh_token&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;eyJ...&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;token_type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;bearer&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;access_expires_in&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>1800</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;refresh_expires_in&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>604800</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;session_id&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;session_123&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;user_info&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nt>&quot;id&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>1</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;username&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;admin&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;roles&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;admin&quot;</span><span class=p>],</span>
<span class=w>    </span><span class=nt>&quot;rbac_session_id&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;rbac_session_456&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;active_tenant_id&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>1</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;cached_permissions&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nt>&quot;1&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;staff:read&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;payroll:write&quot;</span><span class=p>]}</span>
<span class=w>  </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div></p> <h4 id=user-info-with-rbac>User Info with RBAC<a class=headerlink href=#user-info-with-rbac title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class=err>GET /auth/me/rbac?tenant_id=1</span>
<span class=err>Authorization: Bearer eyJ...</span>
</code></pre></div> <p>Response: <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=nt>&quot;id&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>1</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;username&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;admin&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;email&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;admin@example.com&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;first_name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Admin&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;last_name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;User&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;is_active&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;is_email_verified&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;created_at&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2025-01-01T00:00:00Z&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;last_login&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2025-01-01T12:00:00Z&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;accessible_tenant_ids&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>],</span>
<span class=w>  </span><span class=nt>&quot;default_tenant_id&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>1</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;roles&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;admin&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;manager&quot;</span><span class=p>],</span>
<span class=w>  </span><span class=nt>&quot;permissions&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;staff:read&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;staff:write&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;payroll:approve&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;order:read&quot;</span><span class=p>]</span>
<span class=p>}</span>
</code></pre></div></p> <h4 id=permission-check>Permission Check<a class=headerlink href=#permission-check title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class=err>POST /auth/check-permission</span>
<span class=err>Authorization: Bearer eyJ...</span>
<span class=err>Content-Type: application/json</span>

<span class=err>{</span>
<span class=err>  &quot;permission_key&quot;: &quot;payroll:approve&quot;,</span>
<span class=err>  &quot;tenant_id&quot;: 1,</span>
<span class=err>  &quot;resource_id&quot;: &quot;payroll_123&quot;</span>
<span class=err>}</span>
</code></pre></div> <h3 id=rbac-management-endpoints>RBAC Management Endpoints<a class=headerlink href=#rbac-management-endpoints title="Permanent link">&para;</a></h3> <h4 id=user-management>User Management<a class=headerlink href=#user-management title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class=err>GET /rbac/users                    # List users</span>
<span class=err>POST /rbac/users                   # Create user</span>
<span class=err>GET /rbac/users/{id}               # Get user</span>
<span class=err>GET /rbac/users/{id}/permissions   # Get user permissions</span>
</code></pre></div> <h4 id=role-management>Role Management<a class=headerlink href=#role-management title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class=err>GET /rbac/roles                    # List roles</span>
<span class=err>POST /rbac/roles                   # Create role</span>
<span class=err>GET /rbac/roles/{id}               # Get role</span>
</code></pre></div> <h4 id=permission-management>Permission Management<a class=headerlink href=#permission-management title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class=err>GET /rbac/permissions              # List permissions</span>
<span class=err>GET /rbac/permissions/{id}         # Get permission</span>
</code></pre></div> <h4 id=assignment-operations>Assignment Operations<a class=headerlink href=#assignment-operations title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class=err>POST /rbac/assign-role             # Assign role to user</span>
<span class=err>POST /rbac/remove-role             # Remove role from user</span>
<span class=err>POST /rbac/assign-permission       # Assign permission to role</span>
<span class=err>POST /rbac/remove-permission       # Remove permission from role</span>
<span class=err>POST /rbac/grant-direct-permission # Grant direct permission to user</span>
</code></pre></div> <h2 id=backend-implementation>Backend Implementation<a class=headerlink href=#backend-implementation title="Permanent link">&para;</a></h2> <h3 id=service-layer>Service Layer<a class=headerlink href=#service-layer title="Permanent link">&para;</a></h3> <p>The <code>RBACService</code> class provides high-level operations:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>backend.core.rbac_service</span><span class=w> </span><span class=kn>import</span> <span class=n>RBACService</span>

<span class=c1># Initialize service</span>
<span class=n>rbac_service</span> <span class=o>=</span> <span class=n>RBACService</span><span class=p>(</span><span class=n>db_session</span><span class=p>)</span>

<span class=c1># User operations</span>
<span class=n>user</span> <span class=o>=</span> <span class=n>rbac_service</span><span class=o>.</span><span class=n>create_user</span><span class=p>(</span><span class=s2>&quot;username&quot;</span><span class=p>,</span> <span class=s2>&quot;email&quot;</span><span class=p>,</span> <span class=s2>&quot;password&quot;</span><span class=p>)</span>
<span class=n>authenticated</span> <span class=o>=</span> <span class=n>rbac_service</span><span class=o>.</span><span class=n>authenticate_user</span><span class=p>(</span><span class=s2>&quot;username&quot;</span><span class=p>,</span> <span class=s2>&quot;password&quot;</span><span class=p>)</span>

<span class=c1># Role operations</span>
<span class=n>role</span> <span class=o>=</span> <span class=n>rbac_service</span><span class=o>.</span><span class=n>create_role</span><span class=p>(</span><span class=s2>&quot;role_name&quot;</span><span class=p>,</span> <span class=s2>&quot;Display Name&quot;</span><span class=p>)</span>
<span class=n>rbac_service</span><span class=o>.</span><span class=n>assign_role_to_user</span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>role_id</span><span class=p>,</span> <span class=n>tenant_id</span><span class=p>)</span>

<span class=c1># Permission operations</span>
<span class=n>permission</span> <span class=o>=</span> <span class=n>rbac_service</span><span class=o>.</span><span class=n>create_permission</span><span class=p>(</span><span class=s2>&quot;resource:action&quot;</span><span class=p>,</span> <span class=s2>&quot;Name&quot;</span><span class=p>)</span>
<span class=n>rbac_service</span><span class=o>.</span><span class=n>assign_permission_to_role</span><span class=p>(</span><span class=n>role_id</span><span class=p>,</span> <span class=n>permission_id</span><span class=p>)</span>

<span class=c1># Permission checking</span>
<span class=n>has_permission</span> <span class=o>=</span> <span class=n>rbac_service</span><span class=o>.</span><span class=n>check_user_permission</span><span class=p>(</span>
    <span class=n>user_id</span><span class=p>,</span> <span class=s2>&quot;staff:read&quot;</span><span class=p>,</span> <span class=n>tenant_id</span><span class=o>=</span><span class=mi>1</span>
<span class=p>)</span>
</code></pre></div> <h3 id=fastapi-dependencies>FastAPI Dependencies<a class=headerlink href=#fastapi-dependencies title="Permanent link">&para;</a></h3> <p>Use RBAC dependencies for endpoint protection:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>backend.core.rbac_auth</span><span class=w> </span><span class=kn>import</span> <span class=p>(</span>
    <span class=n>require_permission</span><span class=p>,</span> <span class=n>require_role</span><span class=p>,</span> <span class=n>require_admin</span><span class=p>,</span>
    <span class=n>RBACDependency</span>
<span class=p>)</span>

<span class=c1># Single permission</span>
<span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;/api/staff&quot;</span><span class=p>)</span>
<span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>get_staff</span><span class=p>(</span><span class=n>user</span><span class=p>:</span> <span class=n>RBACUser</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>require_permission</span><span class=p>(</span><span class=s2>&quot;staff:read&quot;</span><span class=p>))):</span>
    <span class=k>pass</span>

<span class=c1># Multiple permissions (any)</span>
<span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&quot;/api/payroll/run&quot;</span><span class=p>)</span>
<span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>run_payroll</span><span class=p>(</span>
    <span class=n>user</span><span class=p>:</span> <span class=n>RBACUser</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>require_permissions</span><span class=p>([</span><span class=s2>&quot;payroll:write&quot;</span><span class=p>,</span> <span class=s2>&quot;payroll:approve&quot;</span><span class=p>],</span> <span class=n>require_all</span><span class=o>=</span><span class=kc>False</span><span class=p>))</span>
<span class=p>):</span>
    <span class=k>pass</span>

<span class=c1># Role-based</span>
<span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;/api/admin/settings&quot;</span><span class=p>)</span>
<span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>admin_settings</span><span class=p>(</span><span class=n>user</span><span class=p>:</span> <span class=n>RBACUser</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>require_admin</span><span class=p>())):</span>
    <span class=k>pass</span>

<span class=c1># Custom dependency</span>
<span class=n>advanced_dependency</span> <span class=o>=</span> <span class=n>RBACDependency</span><span class=p>(</span>
    <span class=n>required_permissions</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;order:write&quot;</span><span class=p>],</span>
    <span class=n>required_roles</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;manager&quot;</span><span class=p>],</span>
    <span class=n>tenant_aware</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=n>allow_admin_override</span><span class=o>=</span><span class=kc>True</span>
<span class=p>)</span>

<span class=nd>@app</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&quot;/api/orders&quot;</span><span class=p>)</span>
<span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>create_order</span><span class=p>(</span><span class=n>user</span><span class=p>:</span> <span class=n>RBACUser</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(</span><span class=n>advanced_dependency</span><span class=p>)):</span>
    <span class=k>pass</span>
</code></pre></div> <h2 id=frontend-implementation>Frontend Implementation<a class=headerlink href=#frontend-implementation title="Permanent link">&para;</a></h2> <h3 id=react-context-and-hooks>React Context and Hooks<a class=headerlink href=#react-context-and-hooks title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>RBACProvider</span><span class=p>,</span><span class=w> </span><span class=nx>useRBAC</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s1>&#39;./hooks/useRBAC&#39;</span><span class=p>;</span>

<span class=c1>// App setup</span>
<span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=p>&lt;</span><span class=nt>RBACProvider</span><span class=p>&gt;</span>
<span class=w>      </span><span class=p>&lt;</span><span class=nt>Router</span><span class=p>&gt;</span>
<span class=w>        </span><span class=p>&lt;</span><span class=nt>Routes</span><span class=p>&gt;</span>
<span class=w>          </span><span class=p>&lt;</span><span class=nt>Route</span><span class=w> </span><span class=na>path</span><span class=o>=</span><span class=s>&quot;/login&quot;</span><span class=w> </span><span class=na>element</span><span class=o>=</span><span class=p>{&lt;</span><span class=nt>LoginForm</span><span class=w> </span><span class=p>/&gt;}</span><span class=w> </span><span class=p>/&gt;</span>
<span class=w>          </span><span class=p>&lt;</span><span class=nt>Route</span><span class=w> </span><span class=na>path</span><span class=o>=</span><span class=s>&quot;/dashboard&quot;</span><span class=w> </span><span class=na>element</span><span class=o>=</span><span class=p>{&lt;</span><span class=nt>Dashboard</span><span class=w> </span><span class=p>/&gt;}</span><span class=w> </span><span class=p>/&gt;</span>
<span class=w>        </span><span class=p>&lt;/</span><span class=nt>Routes</span><span class=p>&gt;</span>
<span class=w>      </span><span class=p>&lt;/</span><span class=nt>Router</span><span class=p>&gt;</span>
<span class=w>    </span><span class=p>&lt;/</span><span class=nt>RBACProvider</span><span class=p>&gt;</span>
<span class=w>  </span><span class=p>);</span>
<span class=p>}</span>

<span class=c1>// Component usage</span>
<span class=kd>function</span><span class=w> </span><span class=nx>Dashboard</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>user</span><span class=p>,</span><span class=w> </span><span class=nx>hasPermission</span><span class=p>,</span><span class=w> </span><span class=nx>hasRole</span><span class=p>,</span><span class=w> </span><span class=nx>login</span><span class=p>,</span><span class=w> </span><span class=nx>logout</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRBAC</span><span class=p>();</span>

<span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>canViewPayroll</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>hasPermission</span><span class=p>(</span><span class=s1>&#39;payroll:read&#39;</span><span class=p>);</span>
<span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>isManager</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>hasRole</span><span class=p>(</span><span class=s1>&#39;manager&#39;</span><span class=p>);</span>

<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
<span class=w>      </span><span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span><span class=nx>Welcome</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=nx>user</span><span class=o>?</span><span class=p>.</span><span class=nx>username</span><span class=p>}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
<span class=w>      </span><span class=p>{</span><span class=nx>canViewPayroll</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>&lt;</span><span class=nt>PayrollSection</span><span class=w> </span><span class=p>/&gt;}</span>
<span class=w>      </span><span class=p>{</span><span class=nx>isManager</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>&lt;</span><span class=nt>ManagementTools</span><span class=w> </span><span class=p>/&gt;}</span>
<span class=w>    </span><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
<span class=w>  </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <h3 id=guard-components>Guard Components<a class=headerlink href=#guard-components title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>PermissionGuard</span><span class=p>,</span><span class=w> </span><span class=nx>RoleGuard</span><span class=p>,</span><span class=w> </span><span class=nx>PayrollGuard</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s1>&#39;./components/rbac/RBACGuard&#39;</span><span class=p>;</span>

<span class=kd>function</span><span class=w> </span><span class=nx>ProtectedContent</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
<span class=w>      </span><span class=p>&lt;</span><span class=nt>PermissionGuard</span><span class=w> </span><span class=na>permission</span><span class=o>=</span><span class=s>&quot;staff:read&quot;</span><span class=p>&gt;</span>
<span class=w>        </span><span class=p>&lt;</span><span class=nt>StaffList</span><span class=w> </span><span class=p>/&gt;</span>
<span class=w>      </span><span class=p>&lt;/</span><span class=nt>PermissionGuard</span><span class=p>&gt;</span>

<span class=w>      </span><span class=p>&lt;</span><span class=nt>RoleGuard</span><span class=w> </span><span class=na>roles</span><span class=o>=</span><span class=p>{[</span><span class=s2>&quot;admin&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;manager&quot;</span><span class=p>]}&gt;</span>
<span class=w>        </span><span class=p>&lt;</span><span class=nt>AdminPanel</span><span class=w> </span><span class=p>/&gt;</span>
<span class=w>      </span><span class=p>&lt;/</span><span class=nt>RoleGuard</span><span class=p>&gt;</span>

<span class=w>      </span><span class=p>&lt;</span><span class=nt>PayrollGuard</span><span class=w> </span><span class=na>action</span><span class=o>=</span><span class=s>&quot;approve&quot;</span><span class=p>&gt;</span>
<span class=w>        </span><span class=p>&lt;</span><span class=nt>PayrollApprovalButton</span><span class=w> </span><span class=p>/&gt;</span>
<span class=w>      </span><span class=p>&lt;/</span><span class=nt>PayrollGuard</span><span class=p>&gt;</span>
<span class=w>    </span><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
<span class=w>  </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <h3 id=convenience-hooks>Convenience Hooks<a class=headerlink href=#convenience-hooks title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>usePermission</span><span class=p>,</span><span class=w> </span><span class=nx>useRole</span><span class=p>,</span><span class=w> </span><span class=nx>useIsAdmin</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s1>&#39;./hooks/useRBAC&#39;</span><span class=p>;</span>

<span class=kd>function</span><span class=w> </span><span class=nx>ComponentWithPermissions</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>canEdit</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>usePermission</span><span class=p>(</span><span class=s1>&#39;staff:write&#39;</span><span class=p>);</span>
<span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>isAdmin</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useIsAdmin</span><span class=p>();</span>
<span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>hasManagerRole</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRole</span><span class=p>(</span><span class=s1>&#39;manager&#39;</span><span class=p>);</span>

<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
<span class=w>      </span><span class=p>{</span><span class=nx>canEdit</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>&lt;</span><span class=nt>EditButton</span><span class=w> </span><span class=p>/&gt;}</span>
<span class=w>      </span><span class=p>{</span><span class=nx>isAdmin</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>&lt;</span><span class=nt>AdminControls</span><span class=w> </span><span class=p>/&gt;}</span>
<span class=w>      </span><span class=p>{</span><span class=nx>hasManagerRole</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>&lt;</span><span class=nt>ManagerDashboard</span><span class=w> </span><span class=p>/&gt;}</span>
<span class=w>    </span><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
<span class=w>  </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <h2 id=multi-tenancy-support>Multi-Tenancy Support<a class=headerlink href=#multi-tenancy-support title="Permanent link">&para;</a></h2> <h3 id=tenant-scoped-permissions>Tenant-Scoped Permissions<a class=headerlink href=#tenant-scoped-permissions title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># Backend: Check permission for specific tenant</span>
<span class=n>has_permission</span> <span class=o>=</span> <span class=n>rbac_service</span><span class=o>.</span><span class=n>check_user_permission</span><span class=p>(</span>
    <span class=n>user_id</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
    <span class=n>permission_key</span><span class=o>=</span><span class=s2>&quot;staff:read&quot;</span><span class=p>,</span>
    <span class=n>tenant_id</span><span class=o>=</span><span class=mi>2</span>  <span class=c1># Specific tenant</span>
<span class=p>)</span>

<span class=c1># Grant tenant-specific permission</span>
<span class=n>rbac_service</span><span class=o>.</span><span class=n>grant_direct_permission</span><span class=p>(</span>
    <span class=n>user_id</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
    <span class=n>permission_key</span><span class=o>=</span><span class=s2>&quot;payroll:approve&quot;</span><span class=p>,</span>
    <span class=n>tenant_id</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>  <span class=c1># Only for tenant 2</span>
    <span class=n>expires_at</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span> <span class=o>+</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>30</span><span class=p>)</span>
<span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1>// Frontend: Tenant context</span>
<span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>switchTenant</span><span class=p>,</span><span class=w> </span><span class=nx>activeTenantId</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRBAC</span><span class=p>();</span>

<span class=c1>// Switch active tenant</span>
<span class=k>await</span><span class=w> </span><span class=nx>switchTenant</span><span class=p>(</span><span class=mf>2</span><span class=p>);</span>

<span class=c1>// Check permission for specific tenant</span>
<span class=kd>const</span><span class=w> </span><span class=nx>canApprove</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>hasPermission</span><span class=p>(</span><span class=s1>&#39;payroll:approve&#39;</span><span class=p>,</span><span class=w> </span><span class=mf>2</span><span class=p>);</span>
</code></pre></div> <h2 id=security-features>Security Features<a class=headerlink href=#security-features title="Permanent link">&para;</a></h2> <h3 id=account-lockout>Account Lockout<a class=headerlink href=#account-lockout title="Permanent link">&para;</a></h3> <ul> <li>Automatic lockout after 5 failed login attempts</li> <li>30-minute lockout duration</li> <li>Reset on successful login</li> </ul> <h3 id=session-management>Session Management<a class=headerlink href=#session-management title="Permanent link">&para;</a></h3> <ul> <li>Redis-based session storage</li> <li>Permission caching for performance</li> <li>Session expiration and cleanup</li> <li>Multi-device session tracking</li> </ul> <h3 id=token-security>Token Security<a class=headerlink href=#token-security title="Permanent link">&para;</a></h3> <ul> <li>JWT with unique token IDs (JTI)</li> <li>Token blacklisting on logout</li> <li>Refresh token rotation</li> <li>Session-aware token validation</li> </ul> <h3 id=audit-trail>Audit Trail<a class=headerlink href=#audit-trail title="Permanent link">&para;</a></h3> <ul> <li>All role/permission changes logged</li> <li>User authentication events tracked</li> <li>Administrative actions recorded</li> </ul> <h2 id=performance-considerations>Performance Considerations<a class=headerlink href=#performance-considerations title="Permanent link">&para;</a></h2> <h3 id=permission-caching>Permission Caching<a class=headerlink href=#permission-caching title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># Session-based permission caching</span>
<span class=n>session</span> <span class=o>=</span> <span class=n>rbac_service</span><span class=o>.</span><span class=n>create_rbac_session</span><span class=p>(</span>
    <span class=n>session_id</span><span class=o>=</span><span class=s2>&quot;session_123&quot;</span><span class=p>,</span>
    <span class=n>user_id</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
    <span class=n>active_tenant_id</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
    <span class=c1># Permissions cached automatically</span>
<span class=p>)</span>

<span class=c1># Cache refresh</span>
<span class=n>rbac_service</span><span class=o>.</span><span class=n>refresh_session_cache</span><span class=p>(</span><span class=s2>&quot;session_123&quot;</span><span class=p>)</span>
</code></pre></div> <h3 id=database-optimizations>Database Optimizations<a class=headerlink href=#database-optimizations title="Permanent link">&para;</a></h3> <ul> <li>Indexed permission keys and user IDs</li> <li>Efficient join queries for role inheritance</li> <li>Bulk permission checking operations</li> <li>Connection pooling and query optimization</li> </ul> <h3 id=frontend-optimizations>Frontend Optimizations<a class=headerlink href=#frontend-optimizations title="Permanent link">&para;</a></h3> <ul> <li>React context for global state</li> <li>Memoized permission checks</li> <li>Lazy loading of permission data</li> <li>Local storage for session persistence</li> </ul> <h2 id=migration-and-setup>Migration and Setup<a class=headerlink href=#migration-and-setup title="Permanent link">&para;</a></h2> <h3 id=database-migration>Database Migration<a class=headerlink href=#database-migration title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># Run RBAC migration</span>
alembic<span class=w> </span>upgrade<span class=w> </span>20250727_1600_0012

<span class=c1># Setup default roles and permissions</span>
python<span class=w> </span>-c<span class=w> </span><span class=s2>&quot;</span>
<span class=s2>from backend.core.rbac_service import RBACService</span>
<span class=s2>from backend.core.database import get_db</span>
<span class=s2>rbac_service = RBACService(next(get_db()))</span>
<span class=s2>rbac_service.setup_default_roles_and_permissions()</span>
<span class=s2>&quot;</span>
</code></pre></div> <h3 id=environment-configuration>Environment Configuration<a class=headerlink href=#environment-configuration title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code># JWT Settings
JWT_SECRET_KEY=your-secret-key-here
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# Database
DATABASE_URL=postgresql://user:password@localhost/auraconnect

# Redis (for sessions)
REDIS_URL=redis://localhost:6379/0
</code></pre></div> <h2 id=best-practices>Best Practices<a class=headerlink href=#best-practices title="Permanent link">&para;</a></h2> <h3 id=permission-design>Permission Design<a class=headerlink href=#permission-design title="Permanent link">&para;</a></h3> <ol> <li>Use specific, granular permissions</li> <li>Follow <code>resource:action</code> naming convention</li> <li>Avoid overly broad permissions</li> <li>Consider permission inheritance</li> </ol> <h3 id=role-design>Role Design<a class=headerlink href=#role-design title="Permanent link">&para;</a></h3> <ol> <li>Create role hierarchies that reflect business structure</li> <li>Assign minimum necessary permissions</li> <li>Use descriptive role names</li> <li>Document role purposes and responsibilities</li> </ol> <h3 id=security>Security<a class=headerlink href=#security title="Permanent link">&para;</a></h3> <ol> <li>Always validate permissions server-side</li> <li>Use tenant-aware permission checking</li> <li>Implement proper session management</li> <li>Regular permission audits and cleanup</li> </ol> <h3 id=performance>Performance<a class=headerlink href=#performance title="Permanent link">&para;</a></h3> <ol> <li>Cache permissions at session level</li> <li>Use bulk operations for role assignments</li> <li>Monitor database query performance</li> <li>Implement pagination for large datasets</li> </ol> <h2 id=testing>Testing<a class=headerlink href=#testing title="Permanent link">&para;</a></h2> <h3 id=backend-tests>Backend Tests<a class=headerlink href=#backend-tests title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># Run RBAC tests</span>
pytest<span class=w> </span>backend/tests/test_rbac_system.py<span class=w> </span>-v

<span class=c1># Test specific functionality</span>
pytest<span class=w> </span>backend/tests/test_rbac_system.py::TestRBACPermissionChecking<span class=w> </span>-v
</code></pre></div> <h3 id=frontend-tests>Frontend Tests<a class=headerlink href=#frontend-tests title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># Run RBAC hook tests</span>
npm<span class=w> </span><span class=nb>test</span><span class=w> </span>frontend/hooks/__tests__/useRBAC.test.tsx

<span class=c1># Run guard component tests</span>
npm<span class=w> </span><span class=nb>test</span><span class=w> </span>frontend/components/rbac/
</code></pre></div> <h2 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">&para;</a></h2> <h3 id=common-issues>Common Issues<a class=headerlink href=#common-issues title="Permanent link">&para;</a></h3> <ol> <li><strong>Permission Denied Errors</strong></li> <li>Verify user has required role/permission</li> <li>Check tenant context</li> <li> <p>Confirm role-permission assignments</p> </li> <li> <p><strong>Session Issues</strong></p> </li> <li>Check Redis connectivity</li> <li>Verify session expiration</li> <li> <p>Clear browser storage if needed</p> </li> <li> <p><strong>Performance Issues</strong></p> </li> <li>Monitor permission cache hit rates</li> <li>Check database query performance</li> <li>Review role inheritance depth</li> </ol> <h3 id=debug-tools>Debug Tools<a class=headerlink href=#debug-tools title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># Check user permissions</span>
<span class=n>user_permissions</span> <span class=o>=</span> <span class=n>rbac_service</span><span class=o>.</span><span class=n>get_user_permissions</span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>tenant_id</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;User permissions: </span><span class=si>{</span><span class=n>user_permissions</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>

<span class=c1># Check role assignments</span>
<span class=n>user_roles</span> <span class=o>=</span> <span class=n>rbac_service</span><span class=o>.</span><span class=n>get_user_roles</span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>tenant_id</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;User roles: </span><span class=si>{</span><span class=p>[</span><span class=n>role</span><span class=o>.</span><span class=n>name</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>role</span><span class=w> </span><span class=ow>in</span><span class=w> </span><span class=n>user_roles</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1>// Frontend debugging</span>
<span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>user</span><span class=p>,</span><span class=w> </span><span class=nx>hasPermission</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRBAC</span><span class=p>();</span>
<span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Current user:&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>user</span><span class=p>);</span>
<span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Has staff:read:&#39;</span><span class=p>,</span><span class=w> </span><span class=nx>hasPermission</span><span class=p>(</span><span class=s1>&#39;staff:read&#39;</span><span class=p>));</span>
</code></pre></div> <h2 id=conclusion>Conclusion<a class=headerlink href=#conclusion title="Permanent link">&para;</a></h2> <p>The AuraConnect AI RBAC system provides a comprehensive, secure, and scalable solution for access control. It supports complex organizational structures while maintaining performance and usability. The system is designed to grow with your organization's needs while providing the security and audit capabilities required for enterprise applications.</p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> &copy; 2025 <a href=https://auratechwave.com target=_blank rel=noopener>AuraTechWave</a> </div> </div> <div class=md-social> <a href=https://github.com/AuraTechWave target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://twitter.com/auraconnect target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg> </a> <a href=https://linkedin.com/company/auratechwave target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top", "navigation.path", "navigation.prune", "toc.follow", "toc.integrate", "search.suggest", "search.highlight", "search.share", "content.code.annotate", "content.code.copy", "content.tabs.link", "announce.dismiss"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"alias": true, "default": "latest", "provider": "mike"}}</script> <script src=../../../assets/javascripts/bundle.f55a23d4.min.js></script> </body> </html>